CREATE TABLE users (
    id          BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username    VARCHAR(255),
    password    VARCHAR(255),
    created_at  TIMESTAMP(6) NOT NULL,
    modified_at TIMESTAMP(6) NOT NULL,
    deleted_at  TIMESTAMP(6)
);

CREATE TABLE follows (
    id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    follower_id   BIGINT NOT NULL,
    followee_id   BIGINT NOT NULL,
    created_at    TIMESTAMP(6) NOT NULL,
    modified_at   TIMESTAMP(6) NOT NULL,
    deleted_at    TIMESTAMP(6)
);

CREATE INDEX idx_follows_follower_followee_active ON follows(follower_id, followee_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_follows_followee_active ON follows(followee_id) WHERE deleted_at IS NULL;

CREATE TABLE follow_counts (
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id         BIGINT NOT NULL UNIQUE,
    followers_count BIGINT NOT NULL,
    followees_count BIGINT NOT NULL,
    created_at      TIMESTAMP(6) NOT NULL,
    modified_at     TIMESTAMP(6) NOT NULL,
    deleted_at      TIMESTAMP(6)
);

CREATE INDEX idx_follow_counts_user_active ON follow_counts(user_id) WHERE deleted_at IS NULL;
